"use strict";app.controller("modalLevelCtrl",["$scope","$modalInstance","_jiyin","params","FileUploader","dataToURL",function(e,t,i,n){e.infoList=n.infoList,e.title=n.title,e.ael=n.ael,e.$on("attachment_id",function(t,i){e.infoList.attachment_id=i}),"edit"==e.ael&&(e.infoList.attachment_id=e.infoList.icon_id),e.getLevel=function(){i.dataPost("admin/level_admin/get_info").then(function(t){e.levelInfo=t.data})},e.getLevel(),e.cancel=function(){t.dismiss("cancel")},e.ok=function(){if(!e.infoList.name)return void i.msg("e","等级名称不能为空");if(!e.infoList.rank)return void i.msg("e","等级排序不能为空");if(!e.infoList.price_discount)return void i.msg("e","折扣不能为空");if(!e.infoList.points_coefficient)return void i.msg("e","等级积分系数不能为空");if(!e.infoList.price)return void i.msg("e","到当前等级所需价格不能为空");if("add"==e.ael){var n=[],o=[];if(angular.forEach(e.levelInfo,function(e){n[n.length]=e.name,o[o.length]=e.rank}),!$.inArray(e.infoList.name,n))return void i.msg("e","等级名称不能重复");if(!$.inArray(e.infoList.rank,o))return void i.msg("e","等级排序不能重复")}return e.infoList.attachment_id?void t.close(e.infoList):void i.msg("e","还没有上传图片")}}]),app.controller("FileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(e,t,i,n){var o=e.uploader=new t({url:SITE_URL+"attachment/up_attachment"});o.filters.push({name:"customFilter",fn:function(){return this.queue.length<2}}),e.upload=function(t){i.fileMd5(t._file).then(function(a){i.dataPost("attachment/check_md5",n({md5_code:a.md5Code})).then(function(i){1==i.exist?(e.$emit("attachment_id",i.attachment_id),t.file.size=t._file.size,t.progress=100,t.isSuccess=!0,t.isUploaded=!0,t.uploader.progress+=100/o.queue.length):t.upload()})})},e.uploadAll=function(){angular.forEach(o.queue,function(t){i.fileMd5(t._file).then(function(a){i.dataPost("attachment/check_md5",n({md5_code:a.md5Code})).then(function(i){1==i.exist?(e.$emit("attachment_id",i.attachment_id),t.file.size=t._file.size,t.progress=100,t.isSuccess=!0,t.isUploaded=!0,o.progress+=100/o.queue.length):t.upload()})})})},o.onSuccessItem=function(t,i){e.$emit("attachment_id",i.attachment_id)},e.$on("clearQueue",function(){o.clearQueue()})}]);