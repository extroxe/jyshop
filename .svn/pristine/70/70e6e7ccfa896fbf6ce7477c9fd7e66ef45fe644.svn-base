app.controller("commonclassCtrl",["$scope","_jiyin","dataToURL","$stateParams","$state",function(t,e,i,a,n){t.commonclassList={},t.list={},t.reList={},t.inputPage=1,t.dataShow=!0,t.isPoint=!1,t.picList=[],t.getList=function(){e.dataPost("commodity/get_commodity_recommend_commodity",i({commodity_id:t.reList.commodity_id})).then(function(e){(e.success=!0)&&(t.cList=e.data)})},t.recommon=function(e){t.reList.commodity_id=e.id,t.getCate(),t.getList(),$("#recommon").modal("show")},t.addRe=function(){t.showRe=!0},t.sure=function(){t.showRe=!1,e.dataPost("admin/commodity_admin/add_commodity_recommend_commodity",i()).then(function(e){1==e.success&&(t.getList(),$("#recommon").modal("hide"))})},t.remove=function(a){confirm("确认删除此相关推荐吗?")&&e.dataPost("admin/commodity_admin/delete_commodity_recommend_commodity",i({id:a.id})).then(function(i){(i.success=!0)?(e.msg("s","删除成功"),t.getList()):e.msg("e",i.msg)})},t.show=function(){t.title="增加",t.ael="add",t.list={},t.getThumbnail(),t.getStatus(),t.getType(),t.getCate(),$("#add").modal("show")},t.edit=function(e){t.title="编辑",t.ael="edit",t.list=e,t.list.points=parseInt(t.list.points),t.list.sales_volume=parseInt(t.list.sales_volume),t.getThumbnail(),t.getStatus(),t.getType(),t.getCate(),$("#add").modal("show")},t.getThumbnail=function(){t.list.id&&e.dataPost("admin/commodity_admin/show_thumbnail",i({commodity_id:t.list.id})).then(function(e){t.picList=e.data})},t.getStatus=function(){e.dataPost("admin/system_code_admin/get_by_type/commodity_status").then(function(e){t.statusList=e})},t.getType=function(){e.dataPost("admin/system_code_admin/get_by_type/commodity_type").then(function(e){t.typeList=e})},t.getCate=function(){e.dataPost("admin/category_admin/get_categories").then(function(e){t.cateList=e.data})},t.$on("attachment_ids",function(e,i){t.list.attachment_ids=i}),t.$on("path",function(e,i){null==t.picList&&(t.picList=[]);var a=[];a.path=i,t.picList.push(a)}),t.removePic=function(a,n){confirm("确定删除该图片吗?")&&(a?e.dataPost("admin/commodity_admin/delete_thumbnail",i({id:a})).then(function(e){e.success&&t.getThumbnail()}):t.picList.splice(n,1))},t.ok=function(){return t.list.name?t.list.number?t.list.price?0!=t.isPoint||t.list.points?t.list.category_id?t.list.sales_volume?t.list.status_id?t.list.type_id?t.list.detail?t.list.attachment_ids||"add"!=t.ael?void("add"==t.ael?(t.list.is_point=0,e.dataPost("admin/commodity_admin/add",i(t.list)).then(function(i){1==i.success?(e.msg("s","添加成功"),t.getData(),$("#add").modal("hide")):e.msg("e","添加失败")})):e.dataPost("admin/commodity_admin/update",i(t.list)).then(function(i){1==i.success?(e.msg("s","修改成功"),t.getData(),$("#add").modal("hide")):e.msg("e","修改失败")})):void e.msg("e","还没有上传图片"):void e.msg("e","商品详情不能为空"):void e.msg("e","商品类型不能为空"):void e.msg("e","商品状态不能为空"):void e.msg("e","商品销量不能为空"):void e.msg("e","商品分类不能为空"):void e.msg("e","商品购买获得积分不能为空"):void e.msg("e","商品价格不能为空"):void e.msg("e","商品编号不能为空"):void e.msg("e","商品名称不能为空")},t.getData=function(){e.dataGet("admin/commodity_admin/paginate/"+t.inputPage+"/10").then(function(e){e.total_page===!1?(t.dataShow=!1,t.totalPage=1):t.totalPage=e.total_page,t.commonclassList=e.data})},t.getData(),t.deleteData=function(a){confirm("确认删除这条数据吗?")&&e.dataPost("admin/commodity_admin/delete",i({id:a.id})).then(function(){e.msg("s","删除成功"),t.getData()})},t.lookEva=function(t){n.go("app.evaluate",{commodity_id:t.id,type:"com"})},t.nextPage=function(){t.inputPage<t.totalPage?(t.inputPage++,t.getData()):e.msg("e","当前是最后一页")},t.previousPage=function(){t.inputPage>1?(t.inputPage--,t.getData()):e.msg("e","当前是第一页")},t.firstPage=function(){t.inputPage=1,t.getData()},t.lastPage=function(){t.inputPage=t.totalPage,t.getData()},t.selectPage=function(e){t.inputPage=e,t.getData()}}]),app.controller("comFileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(t,e,i,a){t.attachment_ids=[];var n=t.uploader=new e({url:SITE_URL+"attachment/up_attachment"});n.filters.push({name:"customFilter",fn:function(){return this.queue.length<6}}),t.upload=function(e){i.fileMd5(e._file).then(function(o){i.dataPost("attachment/check_md5",a({md5_code:o.md5Code})).then(function(i){1==i.exist?(t.attachment_ids.push(i.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",i.path),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,e.uploader.progress+=100/n.queue.length):e.upload()})})},t.uploadAll=function(){angular.forEach(n.queue,function(e){i.fileMd5(e._file).then(function(o){i.dataPost("attachment/check_md5",a({md5_code:o.md5Code})).then(function(i){1==i.exist?(t.attachment_ids.push(i.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",i.path),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,n.progress+=100/n.queue.length):e.upload()})})})},n.onSuccessItem=function(e,i){t.attachment_ids.push(i.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",i.path)},t.$on("clearQueue",function(){n.clearQueue()})}]);