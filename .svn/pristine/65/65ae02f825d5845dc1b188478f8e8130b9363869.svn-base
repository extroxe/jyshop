"use strict";app.controller("modalUserCtrl",["$scope","$modalInstance","_jiyin","params","FileUploader","dataToURL",function(e,t,i,n){e.infoList=n.infoList,e.title=n.title,e.ael=n.ael,e.infoList.is_show&&(e.showFlag=e.infoList.is_show=!0),e.getRole=function(){i.dataPost("admin/system_code_admin/get_by_type/role").then(function(t){e.roleList=t})},e.getRole(),e.getLevel=function(){i.dataPost("admin/level_admin/get_level").then(function(t){e.levelList=t.data})},e.getLevel(),e.$on("attachment_id",function(t,i){e.infoList.attachment_id=i}),e.cancel=function(){t.dismiss("cancel")},e.ok=function(){if(!e.infoList.password)return void i.msg("e","密码不能为空");if(!e.infoList.username)return void i.msg("e","用户名不能为空");if(!e.infoList.phone)return void i.msg("e","电话号码不能为空");if(!e.infoList.current_point)return void i.msg("e","当前积分不能为空");if(!e.infoList.total_point)return void i.msg("e","总积分不能为空");if(!e.infoList.role_id)return void i.msg("e","角色不能为空");e.infoList.is_show=1;var n=/^1(3|4|5|7|8)\d{9}$/,o=/^\w+@\w+\..+$/;return e.infoList.phone&&0==n.test(e.infoList.phone)?void i.msg("e","手机号不符合规则"):e.infoList.email&&0==o.test(e.infoList.email)?void i.msg("e","邮箱不符合规则"):void t.close(e.infoList)}}]),app.controller("FileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(e,t,i,n){var o=e.uploader=new t({url:SITE_URL+"attachment/up_attachment"});o.filters.push({name:"customFilter",fn:function(){return this.queue.length<2}}),e.upload=function(t){i.fileMd5(t._file).then(function(s){i.dataPost("attachment/check_md5",n({md5_code:s.md5Code})).then(function(i){1==i.exist?(e.$emit("attachment_id",i.attachment_id),t.file.size=t._file.size,t.progress=100,t.isSuccess=!0,t.isUploaded=!0,t.uploader.progress+=100/o.queue.length):t.upload()})})},e.uploadAll=function(){angular.forEach(o.queue,function(t){i.fileMd5(t._file).then(function(s){i.dataPost("attachment/check_md5",n({md5_code:s.md5Code})).then(function(i){1==i.exist?(e.$emit("attachment_id",i.attachment_id),t.file.size=t._file.size,t.progress=100,t.isSuccess=!0,t.isUploaded=!0,o.progress+=100/o.queue.length):t.upload()})})})},o.onSuccessItem=function(t,i){e.$emit("attachment_id",i.attachment_id)},e.$on("clearQueue",function(){o.clearQueue()})}]);