app.controller("integralCtrl",["$scope","_jiyin","dataToURL","$stateParams","$state",function(t,i,e,a,n){t.integralList={},t.inputPage=1,t.reList={},t.list={},t.isPoint=!0,t.picList=[],t.keyword="",t.urlPC="",t.urlWC="",t.search=function(){t.inputPage=1,i.dataPost("admin/commodity_admin/paginate/"+t.inputPage+"/10",e({keyword:t.keyword,is_point:1})).then(function(i){t.integralList=i.data,t.totalPage=i.total_page})},$("#search").keydown(function(i){13==i.keyCode&&t.search()}),t.getCo=function(){i.dataPost("admin/commodity_admin/get_all_commodity_by_is_point",e({is_point:1,keyword:t.keyword})).then(function(i){t.coList=i.data})},t.getList=function(){i.dataPost("commodity/get_commodity_recommend_commodity",e({commodity_id:t.reList.commodity_id})).then(function(i){(i.success=!0)&&(t.cList=i.data)})},t.recommon=function(i){t.reList.commodity_id=i.id,t.getCo(),t.getList(),$("#recommon").modal("show")},t.addRe=function(){t.showRe=!0},t.sure=function(){t.showRe=!1,i.dataPost("admin/commodity_admin/add_commodity_recommend_commodity",e({commodity_id:t.reList.commodity_id,recommend_commodity_id:t.reList.recommend_commodity_id})).then(function(e){1==e.success?(i.msg("s","增加成功"),t.getList(),$("#recommon").modal("hide")):i.msg("e",e.msg)})},t.remove=function(a){confirm("确认删除此相关推荐吗?")&&i.dataPost("admin/commodity_admin/delete_commodity_recommend_commodity",e({id:a.id})).then(function(e){(e.success=!0)?(i.msg("s","删除成功"),t.getList()):i.msg("e",e.msg)})},t.show=function(){t.title="增加",t.ael="add",t.list={},t.url=!1,t.getThumbnail(),t.getStatus(),t.getType(),t.getCate(),t.getLevel(),$("#add").modal("show")},t.edit=function(i){t.title="编辑",t.ael="edit",t.url=!0,t.urlPC="http://jyshop-dev.sailwish.com/commodity/index/"+i.id,t.urlWC="http://jyshop-dev.sailwish.com/weixin/index/commodity_detail/"+i.id,t.list=i,t.list.points=parseInt(t.list.points),t.list.sales_volume=parseInt(t.list.sales_volume),t.getThumbnail(),t.getStatus(),t.getType(),t.getCate(),t.getLevel(),$("#add").modal("show")},t.getThumbnail=function(){t.list.id&&i.dataPost("admin/commodity_admin/show_thumbnail",e({commodity_id:t.list.id})).then(function(i){t.picList=i.data})},t.getStatus=function(){i.dataPost("admin/system_code_admin/get_by_type/commodity_status").then(function(i){t.statusList=i})},t.getType=function(){i.dataPost("admin/system_code_admin/get_by_type/commodity_type").then(function(i){t.typeList=i})},t.getLevel=function(){i.dataGet("admin/level_admin/get_level").then(function(i){t.levelList=i.data})},t.getCate=function(){i.dataPost("admin/category_admin/get_categories").then(function(i){t.cateList=i.data})},t.$on("attachment_ids",function(i,e){t.list.attachment_ids||(t.list.attachment_ids=[]),t.list.attachment_ids.push(e)}),t.$on("path",function(i,e){null==t.picList&&(t.picList=[]);var a=[];a.path=e,t.picList.push(a)}),t.removePic=function(a,n){confirm("确定删除该图片吗?")&&(a?i.dataPost("admin/commodity_admin/delete_thumbnail",e({id:a})).then(function(){t.picList.splice(n,1),t.getThumbnail()}):t.picList.splice(n,1))},t.ok=function(){return t.list.name?t.list.number?t.list.price?0!=t.isPoint||t.list.points?t.list.category_id?t.list.sales_volume?t.list.status_id?t.list.type_id?t.list.detail?t.list.attachment_ids||"add"!=t.ael?(t.list.attachment_ids&&(t.list.attachment_ids=t.list.attachment_ids.toString()),void("add"==t.ael?(t.list.is_point=1,i.dataPost("admin/commodity_admin/add",e(t.list)).then(function(e){1==e.success?(i.msg("s","添加成功"),t.getData(),$("#add").modal("hide")):i.msg("e",e.msg)})):i.dataPost("admin/commodity_admin/update",e(t.list)).then(function(e){1==e.success?(i.msg("s","修改成功"),t.getData(),$("#add").modal("hide")):i.msg("e",e.msg)}))):void i.msg("e","还没有上传图片"):void i.msg("e","商品详情不能为空"):void i.msg("e","商品类型不能为空"):void i.msg("e","商品状态不能为空"):void i.msg("e","商品销量不能为空"):void i.msg("e","商品分类不能为空"):void i.msg("e","商品购买获得积分不能为空"):void i.msg("e","商品价格不能为空"):void i.msg("e","商品编号不能为空"):void i.msg("e","商品名称不能为空")},t.getData=function(){i.dataPost("admin/commodity_admin/paginate/"+t.inputPage+"/10",e({is_point:1,keyword:t.keyword})).then(function(i){t.integralList=i.data,t.totalPage=i.total_page})},t.getData(),t.deleteData=function(a){confirm("确认删除这条数据吗?")&&i.dataPost("admin/commodity_admin/delete",e({id:a.id})).then(function(e){1==e.success?(i.msg("s","删除成功"),t.getData()):i.msg("e",e.msg)})},t.lookEva=function(t){n.go("app.evaluate",{commodity_id:t.id,type:"int"})},t.nextPage=function(){t.inputPage<t.totalPage?(t.inputPage++,t.getData()):i.msg("e","当前是最后一页")},t.previousPage=function(){t.inputPage>1?(t.inputPage--,t.getData()):i.msg("e","当前是第一页")},t.firstPage=function(){t.inputPage=1,t.getData()},t.lastPage=function(){t.inputPage=t.totalPage,t.getData()},t.selectPage=function(i){t.inputPage=i,t.getData()}}]),app.controller("intFileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(t,i,e,a){t.attachment_ids=[];var n=t.uploader=new i({url:SITE_URL+"attachment/up_attachment"});n.filters.push({name:"customFilter",fn:function(){return this.queue.length<6}}),t.upload=function(i){e.fileMd5(i._file).then(function(o){e.dataPost("attachment/check_md5",a({md5_code:o.md5Code})).then(function(e){1==e.exist?(t.attachment_ids=[],t.attachment_ids.push(e.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",e.path),i.file.size=i._file.size,i.progress=100,i.isSuccess=!0,i.isUploaded=!0,i.uploader.progress+=100/n.queue.length):i.upload()})})},t.uploadAll=function(){angular.forEach(n.queue,function(i){e.fileMd5(i._file).then(function(o){e.dataPost("attachment/check_md5",a({md5_code:o.md5Code})).then(function(e){1==e.exist?(t.attachment_ids=[],t.attachment_ids.push(e.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",e.path),i.file.size=i._file.size,i.progress=100,i.isSuccess=!0,i.isUploaded=!0,n.progress+=100/n.queue.length):i.upload()})})})},n.onSuccessItem=function(i,e){t.attachment_ids=[],t.attachment_ids.push(e.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",e.url)},t.$on("clearQueue",function(){n.clearQueue()})}]);