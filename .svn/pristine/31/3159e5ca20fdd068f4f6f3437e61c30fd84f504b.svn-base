"use strict";app.controller("modalCommoClassCtrl",["$scope","$modalInstance","_jiyin","params","FileUploader","dataToURL",function(t,i,e,n,o,s){t.infoList=n.commonclassList,t.title=n.title,t.ael=n.ael,t.isPoint=n.isPoint,t.infoList&&(t.infoList.points=parseInt(t.infoList.points),t.infoList.sales_volume=parseInt(t.infoList.sales_volume)),t.items=["fontname","fontsize","forecolor","bold","underline","emoticons","link"],t.getThumbnail=function(){t.infoList.id&&e.dataPost("admin/commodity_admin/show_thumbnail",s({commodity_id:t.infoList.id})).then(function(i){t.picList=i.data})},t.getThumbnail(),t.getStatus=function(){e.dataPost("admin/system_code_admin/get_by_type/commodity_status").then(function(i){t.statusList=i})},t.getStatus(),t.getType=function(){e.dataPost("admin/system_code_admin/get_by_type/commodity_type").then(function(i){t.typeList=i})},t.getType(),t.getCate=function(){e.dataPost("admin/category_admin/get_categories").then(function(i){t.cateList=i.data})},t.getCate(),t.$on("attachment_ids",function(i,e){t.infoList.attachment_ids=e}),t.removePic=function(i){comfirm("确定删除该图片吗?")&&e.dataPost("admin/commodity_admin/delete_thumbnail",s({id:i})).then(function(i){i.success&&t.getThumbnail()})},t.removeEditor=function(){var t=$("#introduce"),i=$("#detail");KindEditor.remove(t),KindEditor.remove(i)},t.cancel=function(){t.removeEditor(),i.dismiss("cancel")},t.ok=function(){return t.infoList.name?t.infoList.number?t.infoList.price?0!=t.isPoint||t.infoList.points?t.infoList.category_id?t.infoList.sales_volume?t.infoList.status_id?t.infoList.type_id?t.infoList.detail?t.infoList.attachment_ids||"add"!=t.ael?void i.close(t.infoList):void e.msg("e","还没有上传图片"):void e.msg("e","商品详情不能为空"):void e.msg("e","商品类型不能为空"):void e.msg("e","商品状态不能为空"):void e.msg("e","商品销量不能为空"):void e.msg("e","商品分类不能为空"):void e.msg("e","商品购买获得积分不能为空"):void e.msg("e","商品价格不能为空"):void e.msg("e","商品编号不能为空"):void e.msg("e","商品名称不能为空")}}]),app.controller("FileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(t,i,e,n){t.attachment_ids=[];var o=t.uploader=new i({url:SITE_URL+"attachment/up_attachment"});o.filters.push({name:"customFilter",fn:function(){return this.queue.length<6}}),t.upload=function(i){e.fileMd5(i._file).then(function(s){e.dataPost("attachment/check_md5",n({md5_code:s.md5Code})).then(function(e){1==e.exist?(t.attachment_ids.push(e.attachment_id),t.$emit("attachment_ids",t.attachment_ids),i.file.size=i._file.size,i.progress=100,i.isSuccess=!0,i.isUploaded=!0,i.uploader.progress+=100/o.queue.length):i.upload()})})},t.uploadAll=function(){angular.forEach(o.queue,function(i){e.fileMd5(i._file).then(function(s){e.dataPost("attachment/check_md5",n({md5_code:s.md5Code})).then(function(e){1==e.exist?(t.attachment_ids.push(e.attachment_id),t.$emit("attachment_ids",t.attachment_ids),i.file.size=i._file.size,i.progress=100,i.isSuccess=!0,i.isUploaded=!0,o.progress+=100/o.queue.length):i.upload()})})})},o.onSuccessItem=function(i,e){t.attachment_ids.push(e.attachment_id),t.$emit("attachment_ids",t.attachment_ids)},t.$on("clearQueue",function(){o.clearQueue()})}]);