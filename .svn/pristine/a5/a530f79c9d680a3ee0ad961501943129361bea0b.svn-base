app.controller("articleCtrl",["$scope","_jiyin","dataToURL",function(t,e,a){t.articleList={},t.inputPage=1,t.infoList={},t.show=function(){t.title="增加",t.add=!0,t.infoList={},$("#article").modal("show")},t.edit=function(e){t.title="编辑",t.infoList=e,t.add=!1,$("#article").modal("show")},t.getStatus=function(){e.dataPost("admin/system_code_admin/get_by_type/article_status").then(function(e){t.statusList=e})},t.getStatus(),t.$on("attachment_id",function(e,a){t.infoList.thumbnail_id=a}),t.ok=function(){return t.infoList.title?t.infoList.abstract?t.infoList.content?t.infoList.status_id?t.infoList.thumbnail_id?void(1==t.add?e.dataPost("admin/article_admin/add",a(t.infoList)).then(function(a){1==a.success?(e.msg("s","添加成功"),t.getData(),$("#article").modal("hide")):e.msg("e",a.error)}):e.dataPost("admin/article_admin/update",a(t.infoList)).then(function(a){1==a.success?(e.msg("s","修改成功"),t.getData(),$("#article").modal("hide")):e.msg("e",a.error)})):void e.msg("e","还没有上传图片"):void e.msg("e","状态不能为空"):void e.msg("e","文章内容不能为空"):void e.msg("e","文章摘要不能为空"):void e.msg("e","文章标题不能为空")},t.cancel=function(){$("#article").modal("hide")},t.getData=function(){e.dataGet("admin/article_admin/paginate/"+t.inputPage+"/10").then(function(e){t.totalPage=e.total_page===!1?1:e.total_page,t.articleList=e.data})},t.getData(),t.deleteData=function(i){confirm("确认删除这条数据吗?")&&e.dataPost("admin/article_admin/delete",a({id:i.id})).then(function(a){1==a.success?(e.msg("s",a.msg),t.getData()):e.msg("e",a.msg)})},t.nextPage=function(){t.inputPage<t.totalPage?(t.inputPage++,t.getData()):e.msg("e","当前是最后一页")},t.previousPage=function(){t.inputPage>1?(t.inputPage--,t.getData()):e.msg("e","当前是第一页")},t.firstPage=function(){t.inputPage=1,t.getData()},t.lastPage=function(){t.inputPage=t.totalPage,t.getData()},t.selectPage=function(e){t.inputPage=e,t.getData()}}]),app.controller("FileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(t,e,a,i){var n=t.uploader=new e({url:SITE_URL+"attachment/up_attachment"});n.filters.push({name:"customFilter",fn:function(){return this.queue.length<2}}),t.upload=function(e){a.fileMd5(e._file).then(function(o){a.dataPost("attachment/check_md5",i({md5_code:o.md5Code})).then(function(a){1==a.exist?(t.$emit("attachment_id",a.attachment_id),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,e.uploader.progress+=100/n.queue.length):e.upload()})})},t.uploadAll=function(){angular.forEach(n.queue,function(e){a.fileMd5(e._file).then(function(o){a.dataPost("attachment/check_md5",i({md5_code:o.md5Code})).then(function(a){1==a.exist?(t.$emit("attachment_id",a.attachment_id),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,n.progress+=100/n.queue.length):e.upload()})})})},n.onSuccessItem=function(e,a){t.$emit("attachment_id",a.attachment_id)},t.$on("clearQueue",function(){n.clearQueue()})}]);